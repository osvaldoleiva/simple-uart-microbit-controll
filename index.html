<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />

  <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />

  <meta name="theme-color" content="#c55a11" />

  <title>Genta Robot – Control micro:bit</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />

  <!-- Estilos -->
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* Necesario para que Android permita los gestos como user-gesture válidos */
    html, body, button, input, #controls { touch-action: manipulation; }
    button { -webkit-tap-highlight-color: transparent; }
  </style>
</head>

<body oncontextmenu="return false;">

  <header class="app-header">
    <div class="brand">
      <img src="img/genta-logo.svg" class="brand-logo" alt="Genta Logo" />
      <div class="brand-text">
        <h1>Genta Robot</h1>
        <p>Control Bluetooth para micro:bit</p>
      </div>
    </div>
  </header>

  <main class="app-main">

    <!-- Conexión -->
    <section class="card">
      <h2>Conectar micro:bit</h2>
      <p class="card-description">
        Presiona el botón para vincular tu micro:bit vía Bluetooth.
      </p>

      <button id="connectBtn" class="btn btn-primary">
        Conectar micro:bit
      </button>

      <div id="status" class="status">Estado: desconectado</div>

      <div id="robotShow" class="robot-indicator">
        Robot desconectado
      </div>
    </section>

    <!-- Controles -->
    <section class="card">
      <h2>Controles del robot</h2>
      <p class="card-description">
        Mantén presionados los botones para mover el robot.
      </p>

      <div id="controls" class="control-pad">

        <div></div>
        <button id="btnUp" class="ctl-btn btn-control" data-action="UP">Arriba</button>
        <div></div>

        <button id="btnLeft" class="ctl-btn btn-control" data-action="LEFT">Izquierda</button>
        <button id="btnStop" class="btn btn-stop">Detener</button>
        <button id="btnRight" class="ctl-btn btn-control" data-action="RIGHT">Derecha</button>

        <div></div>
        <button id="btnDown" class="ctl-btn btn-control" data-action="DOWN">Abajo</button>
        <div></div>

        <button id="btnHorn" class="ctl-btn btn-accent" data-action="HORN">
          Bocina
        </button>

      </div>
    </section>

  </main>

  <footer class="app-footer">
    Genta Soluciones Eduactivas – Robótica para colegios
  </footer>

  <!-- JS -->
  <script src="app.js"></script>
  <script src="functions.js"></script>

  <script>
  // botón conectar (un solo disparo)
  const connectBtn = document.getElementById("connectBtn");
  connectBtn.addEventListener("pointerdown", (e) => {
    if (e.pointerType !== "mouse") e.preventDefault();
  }, { passive: false });
  connectBtn.addEventListener("pointerup", (e) => {
    if (e.pointerType === "mouse" && e.button !== 0) return;
    connectButtonPressed();
  });

  // helpers para controles
  function bindPress(el, action) {
    el.addEventListener("pointerdown", (e) => {
      if (e.pointerType !== "mouse") e.preventDefault();
      buttonPressed(action);  // manda UP/DOWN/LEFT/RIGHT/HORN
      el.setPointerCapture?.(e.pointerId);
    }, { passive: false });

    const stop = (e) => {
      buttonPressed("stop");  // manda STOP una sola vez
      if (e && el.hasPointerCapture?.(e.pointerId)) {
        el.releasePointerCapture(e.pointerId);
      }
    };

    el.addEventListener("pointerup", stop,     { passive: true });
    el.addEventListener("pointerleave", stop, { passive: true });
    el.addEventListener("pointercancel", stop,{ passive: true });
  }

  bindPress(document.getElementById("btnUp"),    "up");
  bindPress(document.getElementById("btnDown"),  "down");
  bindPress(document.getElementById("btnLeft"),  "left");
  bindPress(document.getElementById("btnRight"), "right");
  bindPress(document.getElementById("btnHorn"),  "horn");

  // botón stop explícito
  document.getElementById("btnStop").addEventListener("pointerup", () => {
    buttonPressed("stop");
  });
</script>


</body>
</html>
